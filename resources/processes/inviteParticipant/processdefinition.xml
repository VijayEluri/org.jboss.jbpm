<?xml version="1.0" encoding="UTF-8"?>

<process-definition
  xmlns=""  name="participantInvitation">
   <start-state name="start">
      <transition name="toCreateBpmUser" to="createBpmUser"></transition>
   </start-state>
   <node name="sendInvitation">
      <event type="node-enter">
         <action name="sendInvitationAction" class="com.idega.jbpm.invitation.SendParticipantInvitationMessageHandler">
				<messageExp>
					#{participantInvitationMessage}
				</messageExp>
				<userDataExp>
					#{participantUserData}
				</userDataExp>
				<processInstanceIdExp>
					#{sendFromProcessInstanceId}
				</processInstanceIdExp>
				<bpmUserIdExp>
                    #{bpmUserId}
                </bpmUserIdExp>
				
			</action>
      </event>
      <transition name="toEnd" to="end1"></transition>
   </node>

	<node name="createBpmUser">
		<event type="node-enter">
			<action name="createBpmUserAction" class="com.idega.jbpm.identity.CreateBPMUserHandler">
				<processInstanceIdExp>
					#{sendFromProcessInstanceId}
				</processInstanceIdExp>
				<userDataExp>
					#{participantUserData}
				</userDataExp>
				<roleExpressionExp>
					#{participantRoleExpression}
				</roleExpressionExp>
				<bpmUserIdVariableNameExp>
                    bpmUserId
                </bpmUserIdVariableNameExp>
				
			</action>
		</event>
		<transition to="assignRoleToBpmUser" name="toAssignRoleToBpmUser"></transition>
	</node>

	<node name="assignRoleToBpmUser">
		<event type="node-enter">
			<action class="com.idega.jbpm.identity.authentication.AssignUserToRoleHandler" name="assingRoleToBpmUserAction">
				<processInstanceIdExp>
					#{sendFromProcessInstanceId}
				</processInstanceIdExp>
				<roleExpressionExp>
					#{participantRoleExpression}
				</roleExpressionExp>
				<userIdExp>
					#{bpmUserId}
				</userIdExp>
			</action>
		</event>
		<transition to="sendInvitation" name="toSendInvitation"></transition>
	</node>
   <end-state name="end1">
      <event type="node-enter">
         <action name="endProcessAction" class="com.idega.jbpm.process.business.EndProcessHandler" config-type="constructor"></action>
      </event>
   </end-state>
</process-definition>